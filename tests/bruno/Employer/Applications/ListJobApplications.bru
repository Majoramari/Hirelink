meta {
  name: ListJobApplications
  type: http
  seq: 7
}

get {
  url: {{base_url}}/employer/jobs/{{job_id}}/applications
  body: none
  auth: inherit
}

headers {
  Authorization: Bearer {{employer_access_token}}
}

script:post-response {
  const firstId = res.body?.data?.[0]?.id;
  if (firstId) {
    bru.setEnvVar("application_id", firstId);
  }

	const firstApp = res.body?.data?.[0];
	if (firstApp?.talent) {
		const certs = firstApp.talent.certificates;
		if (!Array.isArray(certs)) {
			throw new Error(
				"Expected res.body.data[0].talent.certificates to be an array",
			);
		}
	}
}

settings {
  encodeUrl: true
  timeout: 0
}
